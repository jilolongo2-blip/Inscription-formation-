<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Inscription des Participants</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
    background:#f5f7fb;
    font-family:"Segoe UI", sans-serif;
}
.card{border-radius:14px;}
.navbar-brand img{width:45px;}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand fw-bold"><img style="width:50px;height:50px" class="img-fluid" src="IMG_0213.PNG">Gestion des Participants</span>
</nav>

<div class="container py-4">

<!-- FORMULAIRE -->
<div class="card shadow-sm mb-4">
<div class="card-header bg-primary text-white fw-bold">
 Formulaire d’inscription
</div>

<div class="card-body">
<div class="row g-3">

<div class="col-md-4">
    <label class="form-label">Nom</label>
    <input type="text" id="nom" class="form-control">
</div>

<div class="col-md-4">
    <label class="form-label">Prénom</label>
    <input type="text" id="prenom" class="form-control">
</div>

<div class="col-md-4">
    <label class="form-label">Postnom</label>
    <input type="text" id="postnom" class="form-control">
</div>

<div class="col-md-4">
    <label class="form-label">Sexe</label>
    <select id="sexe" class="form-select">
        <option value="">-- Choisir --</option>
        <option>Masculin</option>
        <option>Féminin</option>
    </select>
</div>

<div class="col-md-4">
    <label class="form-label">Niveau d’études</label>
    <select id="niveau" class="form-select">
        <option value="">-- Choisir --</option>
        <option>Secondaire</option>
        <option>Graduat</option>
        <option>Licence</option>
        <option>Master</option>
        <option>Doctorat</option>
    </select>
</div>

<div class="col-md-4">
    <label class="form-label">Téléphone</label>
    <input type="tel" id="telephone" class="form-control" placeholder="+24397xxxxxxx">
</div>

<div class="col-md-6">
    <label class="form-label">Profession</label>
    <input type="text" id="profession" class="form-control">
</div>

<div class="col-md-6">
    <label class="form-label">Formation choisie</label>
    <div class="input-group">
        <input type="text" id="formation" class="form-control" readonly>
        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalFormation">
            Choisir
        </button>
    </div>
</div>

<div class="col-12 text-end">
    <button class="btn btn-success" onclick="enregistrer()"> Enregistrer</button>
</div>

</div>
</div>
</div>

<!-- TABLE -->
<div class="card shadow-sm">
<div class="card-header bg-dark text-white fw-bold d-flex justify-content-between align-items-center">
    <span>Liste des participants</span>
    <button class="btn btn-success btn-sm" onclick="exportExcel()">Exporter Excel</button>
</div>

<div class="card-body table-responsive">
<table class="table table-hover align-middle">
<thead class="table-dark">
<tr>
<th>#</th>
<th>Nom complet</th>
<th>Téléphone</th>
<th>Profession</th>
<th>Formation</th>
<th class="text-center">Actions</th>
</tr>
</thead>
<tbody id="tableParticipants"></tbody>
</table>
</div>
</div>

</div>

<!-- MODAL FORMATION -->
<div class="modal fade" id="modalFormation">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">

<div class="modal-header bg-dark text-white">
    <h5 class="modal-title">Choisir une formation</h5>
    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
<div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Développement Web">
    <label class="form-check-label">Développement Web</label>

</div>
    <div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Développement Web">
    <label class="form-check-label">Économétrie appliqué</label>
    
    </div>
    <div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Développement Web">
    <label class="form-check-label">Machine learning</label>
    </div>
<div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Comptabilité SYSCOHADA">
    <label class="form-check-label">Comptabilité SYSCOHADA</label>
</div>

    <div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Comptabilité SYSCOHADA">
    <label class="form-check-label"></label>
    </div>
<div class="form-check">
    <input class="form-check-input" type="radio" name="formationRadio" value="Power BI">
    <label class="form-check-label">entrepôt de données avec Power BI</label>
</div>
</div>

<div class="modal-footer">
    <button class="btn btn-success" onclick="validerFormation()">Valider</button>
</div>

</div>
</div>
</div>

<!-- JAVASCRIPT -->
<script>
let participants = JSON.parse(localStorage.getItem("participants")) || [];
let editIndex = null;

/* FORMATION */
function validerFormation(){
    const r = document.querySelector('input[name="formationRadio"]:checked');
    if(!r){ alert("Choisissez une formation"); return; }
    formation.value = r.value;
    bootstrap.Modal.getInstance(modalFormation).hide();
}

/* ENREGISTRER */
function enregistrer(){
    const telRegex = /^(\+243|0)(81|82|83|84|85|89|97|99)\d{7}$/;
    if(!telRegex.test(telephone.value)){
        alert("Numéro RDC invalide");
        return;
    }

    const data = {
        nom: nom.value,
        prenom: prenom.value,
        postnom: postnom.value,
        telephone: telephone.value,
        profession: profession.value,
        formation: formation.value
    };

    if(Object.values(data).includes("")){
        alert("Tous les champs sont obligatoires");
        return;
    }

    if(editIndex === null){
        participants.push(data);
    }else{
        participants[editIndex] = data;
        editIndex = null;
    }

    localStorage.setItem("participants", JSON.stringify(participants));
    afficher();
    resetForm();
}

/* AFFICHAGE */
function afficher(){
    tableParticipants.innerHTML = "";
    participants.forEach((p,i)=>{
        tableParticipants.innerHTML += `
        <tr>
            <td>${i+1}</td>
            <td>${p.nom} ${p.prenom} ${p.postnom}</td>
            <td>${p.telephone}</td>
            <td>${p.profession}</td>
            <td>${p.formation}</td>
            <td class="text-center">
                <button class="btn btn-warning btn-sm" onclick="modifier(${i})">modifier</button>
                
            </td>
        </tr>`;
    });
}

/* MODIFIER */
function modifier(i){
    const p = participants[i];
    nom.value = p.nom;
    prenom.value = p.prenom;
    postnom.value = p.postnom;
    telephone.value = p.telephone;
    profession.value = p.profession;
    formation.value = p.formation;
    editIndex = i;
    window.scrollTo({top:0, behavior:"smooth"});
}

/* SUPPRIMER */
function supprimer(i){
    if(confirm("Supprimer ce participant ?")){
        participants.splice(i,1);
        localStorage.setItem("participants", JSON.stringify(participants));
        afficher();
    }
}

/* RESET */
function resetForm(){
    document.querySelectorAll("input, select").forEach(e=>e.value="");
    document.querySelectorAll('input[name="formationRadio"]').forEach(r=>r.checked=false);
}

/* EXPORT EXCEL */
function exportExcel(){
    if(participants.length === 0){
        alert("Aucune donnée à exporter");
        return;
    }

    const data = participants.map((p,i)=>({
        "N°": i+1,
        "Nom": p.nom,
        "Prénom": p.prenom,
        "Postnom": p.postnom,
        "Téléphone": p.telephone,
        "Profession": p.profession,
        "Formation": p.formation
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Participants");
    XLSX.writeFile(wb, "liste_participants.xlsx");
}

afficher();
</script>

</body>
</html>

